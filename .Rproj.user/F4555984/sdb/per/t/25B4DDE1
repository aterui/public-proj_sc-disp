{
    "collab_server" : "",
    "contents" : "# --- Data load ---\nd <- read.csv(\"data/Todd_final.csv\"); d <- d[,1:which(colnames(d)==\"COMMENTS\")]\n\n# --- Data sort ---\n## Remove data without tag info\nrm <- na.action( na.omit(d$TAGID) )\nD <- d[-rm,]\n\n## Select species\nspecies <- \"BHC\" # \"BHC\" or \"STJ\" or \"CRC\"\nD <- D[D$SPE_COR == species,]\n\n## Reshape data\nindID <- sort( unique(D$TAGID) ) # individual tagID\noccID <- sort( unique(D$Occasion) ) # occasionID\nsize <- mat <- matrix(nrow = length(indID), ncol = length(occID))\n\nfor(i in 1:length(indID) ){\n  tmp <- D[D$TAGID == indID[i],]\n  for(j in 1:nrow(tmp)){\n    mat[i,tmp$Occasion[j]] <- tmp$SEC[j]\n    size[i,tmp$Occasion[j]] <- tmp$LEN_COR[j]\n  }\n}\nsize_vector <- apply(size, 1, mean, na.rm=T)\n\n# --- Vectorize data ---\n## Transform location data to displacement distance or recapture history\nsource(\"function_getY.R\"); source(\"function_getYrecap.R\"); source(\"function_getlimit.R\")\nstart_occ <- 3\n\nY <- getY(mat, start = start_occ); colnames(Y) <- NULL\nYrecap <- getYrecap(mat, start = start_occ); colnames(Yrecap) <- NULL\nYlimit <- getlimit(mat, start = start_occ, ulimit = 26, truncation = T)\n\n## Remove unmarked individuals in occations \"start_occ\" to 15\ncap <- apply(Yrecap, 1, function(x) ifelse(all(is.na(x)), 0, 1) )\nY <- Y[which(cap == 1),]\nYrecap <- Yrecap[which(cap == 1),]\nDL <- Ylimit$DL[which(cap == 1),]\nUL <- Ylimit$UL[which(cap == 1),]\n\n## Output data\nIND_ID <- rep( 1:nrow(Y), ncol(Y) )\nPeriod <- as.vector(sapply(1:ncol(Y), rep, nrow(Y)) )\nSt_occ <- Period + (start_occ - 1)\nEnd_occ <- Period + (start_occ)\ntmp <- data.frame(Y = as.vector(Y), Yrecap = as.vector(Yrecap),\n                  DL = as.vector(DL), UL = as.vector(UL), IND_ID, Period, St_occ, End_occ)\noutput <- tmp[is.na(tmp$Yrecap) == 0,]\n\n#write.csv(output, paste0(\"data/Vdata_Todd_\", species, Sys.Date(),\".csv\") )\n",
    "created" : 1515374089863.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2999482670",
    "id" : "25B4DDE1",
    "lastKnownWriteTime" : 1532016807,
    "last_content_update" : 1532016807644,
    "path" : "~/Rstudio_project/NC_dispersal/datasort_Todd.R",
    "project_path" : "datasort_Todd.R",
    "properties" : {
        "source_window_id" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}